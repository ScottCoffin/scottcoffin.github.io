---
title: "data_cv"
author: "Scott Coffin"
date: "11/19/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(skimr)
library(lubridate)
library(plotly)
library(cols4all)
```

```{r}
getwd()
#read in data
cv <- readxl::read_xlsx("presentation tracking spreadsheet.xlsx",
                        sheet = "data")

#convert dates
date <- cv %>% 
  mutate(day = 1) %>% 
  mutate(month_number = match(Month, month.name)) %>% 
  mutate(date = make_date(year = Year, month = month_number, day = day)) %>% 
  mutate(Category = as.factor(Category),
       Type = as.factor(Type),
       Face = as.factor(Face))


#plot
engagements <- date %>% 
  ggplot() +
  geom_histogram(aes(x = date,
                     #color = Category,
                     fill = Category
                     #fill = Face,
                     ),
                 binwidth = 91, 
                 position = "stack") + #quarterly
  scale_x_date(limits = as.Date(c("2014-04-01", "2025-11-01")),
               date_breaks = "12 months",
               #date_labels = "%B (%Y)"
               date_labels = "%Y"
               ) +
  scale_fill_discrete_c4a_cat("poly.dark24") +
  ylab("Number per Quarter") +
  labs(title = "Speaking Engagements Over Time",
       subtitle = "Scott Coffin, Ph.D.") +
  theme_minimal(base_size = 18) +
  theme(legend.title = element_blank(),
        plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        legend.position = c(0.15,0.55),
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)
        )

engagements
```
 
```{r}
ggsave(engagements,
       file = "../engagements.jpeg",
       bg = "white",
       dpi = 300,
       width = 8, height = 6,
       units = "in",
       scale = 0.8)
```
 
##plotly
```{r}
plotly <- ggplotly(engagements,
       #  width = 12,
        # height = 8,
         tooltip = c("count", "Category"))

htmlwidgets::saveWidget(plotly::as_widget(plotly), "../widgets/engagements.html")

plotly
```
# Data table
```{r}
library(DT)


table <- date %>% dplyr::select(c(Year, Month, Name, Type, Category))
                        
datatable <- datatable(table,
          options = list(autoWidth = TRUE),
          filter = list(position = 'top'),
          rownames = FALSE)

htmlwidgets::saveWidget(datatable, "assets/widgets/datatable.html")


datatable
```

 
```{r}
date %>%
  group_by(Category) %>% 
  summarize(n())
```
 
 